<html>
<head>
</head>
<body style="background: transparent;">
    <script src="scripts/docstrap.lib.js"></script>
    <script src="scripts/lunr.min.js"></script>
    <script src="scripts/fulltext-search.js"></script>

    <script type="text/x-docstrap-searchdb">
    {"base_array.js.html":{"id":"base_array.js.html","title":"Source: base/array.js","body":" @2dfire/utils Classes imageUtil Global arrayFindarrayFindIndexarrayUniqueclonecreateUrldFireFetchdFireFetchWithoutGlobalenterSocketRoomextractgetGlobalOptionsgetRealUrlisArrayisEmptyisFunctionisJsonisMobilePhoneisNullisNumberisObjectisStringisUndefinednavigateBacknavigateTonumberFixedFennumberFixedYuannumberFormatobjectAssignobjectForEachobjectMapparseparseMessageredirectToselectKeyssetGlobalOptionssetSocketGlobalOptionssetUrlMirrorstartWithstringifystringifyMessagestringTrimstringTrimLeftstringTrimRighttoInttoIntBooltoJsontoNonNegativeIntegertoStrurlMirrorzipCDNImage Source: base/array.js /** * 数组去重 * @param {Array} arr * @return {Array} 去重后数组 */ function arrayUnique (arr) { return Array.from(new Set(arr)); } /** * 数组find,数组中满足提供的测试函数的第一个元素的值 * @see also https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/find * @param {Array} arr 数组 * @param {Function} predicate 在数组每一项上执行的函数 * @return {Any} 满足提供的测试函数的第一个元素的值,否则返回 undefined */ function arrayFind (arr, predicate) { if (arr === null) { throw new TypeError('arrayFind called on null or undefined'); } if (typeof predicate !== 'function') { throw new TypeError('predicate must be a function'); } var list = Object(arr); var length = list.length &gt;&gt;&gt; 0; var thisArg = arguments[2]; var value; for (var i = 0; i &lt; length; i++) { value = list[i]; if (predicate.call(thisArg, value, i, list)) { return value; } } return undefined; } /** * 数组find,返回数组中满足提供的测试函数的第一个元素的索引 * @see also https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/findIndex * @param {Array} arr 数组 * @param {Function} predicate 在数组每一项上执行的函数 * @return {Number} 满足提供的测试函数的第一个元素的索引。否则返回-1 */ function arrayFindIndex (arr, predicate) { if (arr === null) { throw new TypeError('arrayFind called on null or undefined'); } if (typeof predicate !== 'function') { throw new TypeError('predicate must be a function'); } var list = Object(arr); var length = list.length &gt;&gt;&gt; 0; var thisArg = arguments[2]; var value; for (var i = 0; i &lt; length; i++) { value = list[i]; if (predicate.call(thisArg, value, i, list)) { return i; } } return -1; } export { arrayUnique, arrayFind, arrayFindIndex }; export default { arrayUnique, arrayFind, arrayFindIndex }; × Search results Close Documentation generated by JSDoc 3.4.3 on 2018-01-16T14:37:15+08:00 using the DocStrap template. "},"base_object.js.html":{"id":"base_object.js.html","title":"Source: base/object.js","body":" @2dfire/utils Classes imageUtil Global arrayFindarrayFindIndexarrayUniqueclonecreateUrldFireFetchdFireFetchWithoutGlobalenterSocketRoomextractgetGlobalOptionsgetRealUrlisArrayisEmptyisFunctionisJsonisMobilePhoneisNullisNumberisObjectisStringisUndefinednavigateBacknavigateTonumberFixedFennumberFixedYuannumberFormatobjectAssignobjectForEachobjectMapparseparseMessageredirectToselectKeyssetGlobalOptionssetSocketGlobalOptionssetUrlMirrorstartWithstringifystringifyMessagestringTrimstringTrimLeftstringTrimRighttoInttoIntBooltoJsontoNonNegativeIntegertoStrurlMirrorzipCDNImage Source: base/object.js import assign from 'object-assign'; if (!Object.assign) { Object.assign = assign; } /** * 用于将所有可枚举的属性的值从一个或多个源对象复制到目标对象。它将返回目标对象。 * objectAssign(target, ...sources) * @param {Object} target 目标对象 * @param {Object} sources (多个)源对象 * @return {Object} * @example * objectAssign({ a: 1, b: 2 }, { a: 3, c: 4 }); // { a: 3, b: 2, c: 4 } */ const objectAssign = Object.assign; const prototypeToString = Object.prototype.toString; /** * 测试是否是对象 * @param {Any} v * @return {Boolean} true表示是,false表示不是 */ function isObject(obj) { return prototypeToString.call(obj) === &quot;[object Object]&quot; } /** * 测试对象是否是纯粹的对象（通过 &quot;{}&quot; 或者 &quot;new Object&quot; 创建的） * @alias isJson * @param {Any} v * @return {Boolean} true表示是,false表示不是 */ function isPlainObject (obj) { // 检查是否是对象 if (!isObject(obj)) { return false; } const proto = Object.getPrototypeOf(obj); // 如果对象没有prototype (e.g., `Object.create( null )`) 是简单对象 if (!proto) { return true; } const hasOwn = Object.prototype.hasOwnProperty; // 如果对象的constructor和全局Object的constructor相同(e.g. {}) const Ctor = hasOwn.call(proto, &quot;constructor&quot;) &amp;&amp; proto.constructor; return typeof Ctor === &quot;function&quot; &amp;&amp; hasOwn.toString.call(Ctor) === hasOwn.toString.call(Object); } const isJson = isPlainObject; // Array 全局对象 的 isArray方法 if (!Array.isArray) { Array.isArray = function isArray (arg) { return prototypeToString.call(arg) === '[object Array]'; }; } /** * 判断是否是数组 * @param {Any} v * @return {Boolean} true表示是,false表示不是 */ const isArray = Array.isArray; /** * 判断是否是方法 * @param {Any} v * @return {Boolean} true表示是方法,false表示不是 */ function isFunction (v) { return typeof v === 'function'; } /** * 判断是否是字符串 * @param {Any} v * @return {Boolean} true表示是字符串,false表示不是 */ function isString (v) { return typeof v === 'string'; } /** * 判断是否是数字 * @param {Any} v * @return {Boolean} true表示是数字,false表示不是 */ function isNumber (v) { return typeof v === 'number' &amp;&amp; v === v; } /** * 判断是否是null * @param {Any} v * @return {Boolean} true表示是null,false表示不是 */ function isNull (v) { return v === null; } /** * 判断是否是undefined * @param {Any} v * @return {Boolean} true表示是undefined,false表示不是 */ function isUndefined (v) { return v === undefined; } /** * 对象forEach方法 * @param {Object} obj * @param {Function} cb 将被循环执行 * currentValue * callback 的第一个参数，数组中当前被传递的元素。 * index * callback 的第二个参数，数组中当前被传递的元素的索引。 * obj * callback 的第三个参数，调用 map 方法的对象。 * @return {Void} */ function objectForEach (obj, cb) { const hasOwn = Object.prototype.hasOwnProperty; for (const index in obj) { if (hasOwn.call(obj, index)) { cb.call(obj, obj[index], index, obj); } } } /** * 对象map方法 * @param {Object} obj * @param {Function} cb 原数组中的元素经过该方法后返回一个新的元素。 * currentValue * callback 的第一个参数，数组中当前被传递的元素。 * index * callback 的第二个参数，数组中当前被传递的元素的索引。 * obj * callback 的第三个参数，调用 map 方法的对象。 * @return {Object} */ function objectMap (obj, cb) { const newObj = {}; objectForEach(obj, (currentValue, index) =&gt; { newObj[index] = cb.call(obj, obj[index], index, obj); }); return newObj; } /** * 深层次clone * @param {Any} o 需要clone的对象 * @return {Any} clone后的对象 */ function clone(obj) { if (isArray(obj)) { return obj.map(clone); } // Handle Date if (obj instanceof Date) { return new Date(obj.getTime()); } // 简单对象，挨个clone if (isPlainObject(obj)) { return objectMap(obj, clone); } // 以上之外，Function,Number,String,Boolean,null,undefined,非简单对象都直接返回 return obj; } /** * isEmpty 是否为空 * @param {obj} 任意对象 * @return {bol} true/false */ function isEmpty(obj) { // null and undefined are &quot;empty&quot; if (obj === null) return true; if (obj === undefined) return true; // Assume if it has a length property with a non-zero value // that that property is correct. if (typeof obj === &quot;number&quot;) { return obj.length === 0; } if (typeof obj === &quot;string&quot;) { return obj.length === 0; } // Otherwise, does it have any properties of its own? // Note that this doesn't handle // toString and valueOf enumeration bugs in IE &lt; 9 // bug:如果是Date类型,则总是会返回为空 if (typeof obj === &quot;object&quot;) { if (obj.length === undefined) {//对象 for (var key in obj) { if (hasOwnProperty.call(obj, key)) return false; } } else {//数组 return obj.length === 0; } } return true; } /** * add by suanrong * 使用obj中的ks组成新对象并返回 * @param obj Object * @param ks [k1,k2,k3] */ function selectKeys(obj, ks){ obj = obj || {}; var ret = {}; for(var i = 0, len = ks.length; i &lt; len; i++){ ret[ks[i]] = obj[ks[i]]; } return ret; } /** * add by hupo * 转换为string */ function toStr( v ){ if (v) { return JSON.stringify(v); } return ''; } export { isObject, isPlainObject, isJson, isArray, isFunction, isString, isNumber, isNull, isUndefined, objectForEach, objectMap, clone, isEmpty, selectKeys, toStr, objectAssign }; export default { isObject, isPlainObject, isJson, isArray, isFunction, isString, isNumber, isNull, isUndefined, objectForEach, objectMap, clone, isEmpty, selectKeys, toStr, objectAssign }; × Search results Close Documentation generated by JSDoc 3.4.3 on 2018-01-16T14:37:15+08:00 using the DocStrap template. "},"base_url.js.html":{"id":"base_url.js.html","title":"Source: base/url.js","body":" @2dfire/utils Classes imageUtil Global arrayFindarrayFindIndexarrayUniqueclonecreateUrldFireFetchdFireFetchWithoutGlobalenterSocketRoomextractgetGlobalOptionsgetRealUrlisArrayisEmptyisFunctionisJsonisMobilePhoneisNullisNumberisObjectisStringisUndefinednavigateBacknavigateTonumberFixedFennumberFixedYuannumberFormatobjectAssignobjectForEachobjectMapparseparseMessageredirectToselectKeyssetGlobalOptionssetSocketGlobalOptionssetUrlMirrorstartWithstringifystringifyMessagestringTrimstringTrimLeftstringTrimRighttoInttoIntBooltoJsontoNonNegativeIntegertoStrurlMirrorzipCDNImage Source: base/url.js import qs from './qs'; /** * 创建一个地址附带查询参数 * @param {String} baseUrl 基础地址 * @param {Object} params key-value 对象,选填 * @return {void} */ function createUrl (baseUrl, params) { const paramsStr = qs.stringify(params || {}); if (!paramsStr) { return baseUrl; } let subStr = ''; // 没有问号 if (baseUrl.lastIndexOf('?') === -1) { subStr = '?'; } else { // 最后一个字符 const lastChar = baseUrl.slice(-1); // 如果最后接在最后一个字符不是是?并且是&amp;加上一个&amp; if (lastChar !== '&amp;' &amp;&amp; lastChar !== '?') { subStr = '&amp;'; } } return baseUrl + subStr + paramsStr; } export { createUrl }; export default { createUrl }; × Search results Close Documentation generated by JSDoc 3.4.3 on 2018-01-16T14:37:15+08:00 using the DocStrap template. "},"fetch.js.html":{"id":"fetch.js.html","title":"Source: fetch.js","body":" @2dfire/utils Classes imageUtil Global arrayFindarrayFindIndexarrayUniqueclonecreateUrldFireFetchdFireFetchWithoutGlobalenterSocketRoomextractgetGlobalOptionsgetRealUrlisArrayisEmptyisFunctionisJsonisMobilePhoneisNullisNumberisObjectisStringisUndefinednavigateBacknavigateTonumberFixedFennumberFixedYuannumberFormatobjectAssignobjectForEachobjectMapparseparseMessageredirectToselectKeyssetGlobalOptionssetSocketGlobalOptionssetUrlMirrorstartWithstringifystringifyMessagestringTrimstringTrimLeftstringTrimRighttoInttoIntBooltoJsontoNonNegativeIntegertoStrurlMirrorzipCDNImage Source: fetch.js /** * Created by hupo * on 16/10/11. * * node依赖 : 依赖于 zepto $.ajax 后期可以考虑把 zepto 的ajax 单独打包出来 封装成模块 或使用其他更干净的ajax npm 模块 * 本地依赖 : track.js base.js baseStorage.js * * option = { * url: &quot;&quot;, (必选) * type: &quot;get&quot;, * success: callback, (必选) * error: callback, * showLoading: true, 加载动画/统计相关 showLoading true/静默调用 false 不调用 * params: {}, 请求参数 json格式 会被加入url中 * data: {}, post 请求的 data json格式 * beforeSend: callback, * warnMessage: &quot;&quot;, * infoMessage: &quot;&quot;, * errorMessage: &quot;&quot;, * contentType: &quot;&quot;, Content-Type * withoutCookie: false, Sending cookies 默认发送cookie 只有当 options.withoutCookie == true 时,可以不发送cookie * timeout: &quot;15000&quot; node-fetch 特性 不确定是否生效 待测试 * tempData 其他临时数据, 主要用于ajax回调使用 * } * */ import alert from '@2dfire/feed-back-auto/alert'; import Promise from 'PLATFORM/promise'; import ajax from 'PLATFORM/ajax'; import cookie from 'PLATFORM/cookie'; import { clone } from './base/object'; import { createUrl } from './base/url'; import router from './router'; import localStorage from 'PLATFORM/localStorage'; import globalBasePage from './globalBasePage'; import { objectAssign } from '../object'; import { getHeaders } from '@2dfire/common-i18n-tool/lib' import location from 'PLATFORM/location'; import DfAnalytics from 'PLATFORM/analytics'; // 严重错误的code const ERROR_CODES = [ -1, -2 ]; const fecthGlobalOptions = { /** * 全局会话错误处理 * @param {Object} response 服务端返回结果 * @return {Void} */ handleGlobalError: function handleGlobalError(response) { if (+response.code === -1) { // 重新授权前需要清理cookie数据 cookie.clear(); alert.error({ title: '您太久没有动静了', content: '请重新扫码', closeText: '', showIcon: false, duration: -1 }); } }, /** * 全局获取url参数方法 * @return {Object} QueryParams */ getQueryParams: function queryParams() { return { xtoken: cookie.getItem(&quot;token&quot;) || router.route.query.token }; } }; /** * 设置全局会话超时处理 * @param {Function} sessionOutHandler */ function setGlobalOptions(options) { objectAssign(fecthGlobalOptions, options); } class FireFetch { constructor(options) { if (typeof options !== &quot;object&quot;) { throw new Error(&quot;options must's object&quot;); } this.type = &quot;get&quot;; this.timeout = 15000; this.isShowLoading = true; this.beforeSend = undefined; this.url = options.url; this.reload = options.reload; this.success = options.success; this.complete = options.complete; this.error = options.error; this.contentType = &quot;application/x-www-form-urlencoded;application/json;charset=utf-8;&quot;; this.xhrFields = { withCredentials: true }; // 其他 this.warnMessage = options.warnMessage; this.infoMessage = options.infoMessage; this.errorMessage = options.errorMessage; // 统计相关 this.url = createUrl(this.url, options.params); if (options.type != undefined) { this.type = options.type; } if (options.contentType) { this.contentType = options.contentType; } if (options.data) { if (this.method == &quot;get&quot;) { throw new Error(&quot;GET method can't send data, please modify 'data' to 'params' or use POST&quot;); } this.data = options.data; } if (options.withoutCookie) { this.xhrFields.withCredentials = false; } if (options.beforeSend) { this.beforeSend = options.beforeSend; } if (options.timeout !== undefined) { this.timeout = options.timeout; } if (options.showLoading !== undefined) { this.isShowLoading = options.showLoading; } if (options.tempData) { this.tempData = clone(options.tempData); } } successHandler(response, resolve, reject) { if (this.isShowLoading) { globalBasePage &amp;&amp; globalBasePage.stopLoading(); } // todo 这里的location.href需要做映射 by hupo 2017.6.28 if (response.code == 2001) { location.href = &quot;../page/blacklist.html?t=grunt_page_time&quot;; return false; // reject(); } if (response.code == undefined || ERROR_CODES.indexOf(+response.code) !== -1) { this.globalErrorHandler(response); // 全局错误处理 if (this.error) { this.error(response); } if (DfAnalytics) { // 新统计相关 var params = { api: this.url, code: response.code || &quot;&quot;, message: response.message || &quot;&quot; }; DfAnalytics.fire(&quot;Er&quot;, &quot;apiEr&quot;, params); } reject(response); } else { //每次接口返回了成功，就延长指定的cookie1Day // cookie.postPoneAll(); if (this.success) { if (!response.data) { response.data = {}; } this.success(response); } resolve(response); } } errorHandler(response) { if (this.isShowLoading) { globalBasePage &amp;&amp; globalBasePage.stopLoading(); this.globalErrorHandler(response); } if (this.error) { this.error(response); } if (DfAnalytics) { // 新统计相关 var params = { api: this.url, code: response.code || &quot;&quot;, message: response.message || &quot;&quot; }; DfAnalytics.fire(&quot;Er&quot;, &quot;apiEr&quot;, params); } } // 全局的请求出错处理 (这部分不是很清楚 直接copy http.js原来的代码) globalErrorHandler(response) { // 如果是全局错误，交给配置处理 if (ERROR_CODES.indexOf(+response.code) !== -1) { fecthGlobalOptions.handleGlobalError(response); return; } if (this.isShowLoading) { if (this.reload) { //是否重载 globalBasePage &amp;&amp; globalBasePage.showInfo(globalBasePage.type.error, { errorMessage: this.errorMessage, reload: this.reload }); } else if (this.warnMessage) { globalBasePage &amp;&amp; globalBasePage.showInfo(globalBasePage.type.warn, {warnMessage: this.warnMessage}); } else if (this.infoMessage) { globalBasePage &amp;&amp; globalBasePage.showInfo(globalBasePage.type.info, {infoMessage: this.infoMessage}); } } } // 统计/token/时间戳/定位信息/灰度 (参考原 http.js 原来的代码) otherInit() { var params = { xtoken: cookie.getItem(&quot;token&quot;), t: new Date().getTime(), g_entityId: cookie.getItem(&quot;entity_id&quot;) }; var gpsInfo = localStorage.getItem(&quot;gps&quot;); //获取地理位置定位数据 if (gpsInfo) { params[&quot;loc&quot;] = gpsInfo; } // createUrl(this.url, params); } doFetch() { var self = this; if (self.isShowLoading) { // todo globalBasePage globalBasePage &amp;&amp; globalBasePage.startLoading({content: &quot;&quot;}); } // self.otherInit(); var promise = new Promise(function (resolve, reject) { ajax({ type: self.type, url: self.url, dataType: 'json', crossDomain: true, data: self.data, headers: setHeaders(self.ignore_headers), timeout: self.timeout, contentType: self.contentType, xhrFields: self.xhrFields, beforeSend: function () { if (self.beforeSend) { self.beforeSend(); } }, success: function (data) { self.successHandler(data, resolve, reject); }, complete: function () { if (self.complete) { self.complete(); } }, error: function (xhr, type, error) { var resp = { xhr: xhr, type: type, error: error }; console.log(&quot;ajax error: &quot;, resp); self.errorHandler(resp); reject(resp); } }); }); return promise; } } // 国际化标识 var setHeaders = function(ignore_headers) { return getHeaders({ ignore_headers: ignore_headers }) } /** * fetch，将实例化FireFetch，并且执行FireFetch.doFetch * @param {Object} options 请求配置 * @return {Promise} */ function dFireFetch (options) { options.params = objectAssign( {}, options.params || {}, fecthGlobalOptions.getQueryParams() || {} ); var dfFetch = new FireFetch(options); return dfFetch.doFetch(); } /** * 没有全局信息的fetch * @param {Object} options 请求配置 * @return {Promise} */ function dFireFetchWithoutGlobal (options) { if (!options.params) { options.params = {}; } var dfFetch = new FireFetch(options); return dfFetch.doFetch(); } export { FireFetch, dFireFetch, dFireFetchWithoutGlobal, setGlobalOptions }; export default { FireFetch, dFireFetch, dFireFetchWithoutGlobal, setGlobalOptions }; × Search results Close Documentation generated by JSDoc 3.4.3 on 2018-01-16T14:37:15+08:00 using the DocStrap template. "},"socket.js.html":{"id":"socket.js.html","title":"Source: socket.js","body":" @2dfire/utils Classes imageUtil Global arrayFindarrayFindIndexarrayUniqueclonecreateUrldFireFetchdFireFetchWithoutGlobalenterSocketRoomextractgetGlobalOptionsgetRealUrlisArrayisEmptyisFunctionisJsonisMobilePhoneisNullisNumberisObjectisStringisUndefinednavigateBacknavigateTonumberFixedFennumberFixedYuannumberFormatobjectAssignobjectForEachobjectMapparseparseMessageredirectToselectKeyssetGlobalOptionssetSocketGlobalOptionssetUrlMirrorstartWithstringifystringifyMessagestringTrimstringTrimLeftstringTrimRighttoInttoIntBooltoJsontoNonNegativeIntegertoStrurlMirrorzipCDNImage Source: socket.js import io from 'PLATFORM/io'; import { objectAssign } from './base/object'; import { createUrl } from './base/url'; const socketGlobalOptions = { /** * 全局获取url方法 * @return url */ getBaseUrl: function getBaseUrl() { return '' }, getDefaultRoom: function getDefaultRoom() { return {} } }; /** * 设置全局会话超时处理 * @param {Function} sessionOutHandler */ export function setSocketGlobalOptions(options) { objectAssign(socketGlobalOptions, options); } /** * 根据room链接socket。如果没有room参数，默认进入全局默认房间 * TODO 之后支持多房间 * @param {Object} room 需要链接房间 * @return {Io} socket实例 */ export function enterSocketRoom(room) { room = room || socketGlobalOptions.getDefaultRoom(); const url = createUrl(socketGlobalOptions.getBaseUrl(), room); return io(url, {}, false); } export default { setSocketGlobalOptions, enterSocketRoom }; × Search results Close Documentation generated by JSDoc 3.4.3 on 2018-01-16T14:37:15+08:00 using the DocStrap template. "},"base_qs.js.html":{"id":"base_qs.js.html","title":"Source: base/qs.js","body":" @2dfire/utils Classes imageUtil Global arrayFindarrayFindIndexarrayUniqueclonecreateUrldFireFetchdFireFetchWithoutGlobalenterSocketRoomextractgetGlobalOptionsgetRealUrlisArrayisEmptyisFunctionisJsonisMobilePhoneisNullisNumberisObjectisStringisUndefinednavigateBacknavigateTonumberFixedFennumberFixedYuannumberFormatobjectAssignobjectForEachobjectMapparseparseMessageredirectToselectKeyssetGlobalOptionssetSocketGlobalOptionssetUrlMirrorstartWithstringifystringifyMessagestringTrimstringTrimLeftstringTrimRighttoInttoIntBooltoJsontoNonNegativeIntegertoStrurlMirrorzipCDNImage Source: base/qs.js /** * @see also https://www.npmjs.com/package/query-string */ import { objectMap, isArray, isPlainObject, isUndefined, isNull } from './object'; import qs from 'query-string'; /** * 简单对象转化为query string,如果参数是对象使用JSON.parse转换 * @param {Object} params 参数 key-value * @return {String} * @example * stringify({ a: 123 }); // &quot;a=123&quot; * stringify({ a: [1] }); // &quot;a=%5B1%5D&quot; */ function stringify(params = undefined) { if (params === undefined) { return ''; } if (!isPlainObject(params)) { throw '请传入一个对象'; } params = objectMap(params, param =&gt; { if (isNull(param) || isUndefined(param) || param === '') { return ''; } return isArray(param) || isPlainObject(param) ? JSON.stringify(param) : param; }); return qs.stringify(params); } /** * query string 转化为对象 * @param {String} q query string * @return {Object} * @example * parse(&quot;a=123&quot;); // { a: 123 } * parse(&quot;a=%5B1%5D&quot;); // { a: &quot;[1]&quot; } */ const parse = qs.parse; /** * 从url中取出能被转化的query string * @param {String} url 需要被提取的url * @return {String} * @example * extract(search); // 'chain_id=9&amp;lottery_activity_id=b' */ const extract = qs.extract; export { stringify, parse, extract }; export default { stringify, parse, extract }; × Search results Close Documentation generated by JSDoc 3.4.3 on 2018-01-16T14:37:15+08:00 using the DocStrap template. "},"zipCDNImage.js.html":{"id":"zipCDNImage.js.html","title":"Source: zipCDNImage.js","body":" @2dfire/utils Classes imageUtil Global arrayFindarrayFindIndexarrayUniqueclonecreateUrldFireFetchdFireFetchWithoutGlobalenterSocketRoomextractgetGlobalOptionsgetRealUrlisArrayisEmptyisFunctionisJsonisMobilePhoneisNullisNumberisObjectisStringisUndefinednavigateBacknavigateTonumberFixedFennumberFixedYuannumberFormatobjectAssignobjectForEachobjectMapparseparseMessageredirectToselectKeyssetGlobalOptionssetSocketGlobalOptionssetUrlMirrorstartWithstringifystringifyMessagestringTrimstringTrimLeftstringTrimRighttoInttoIntBooltoJsontoNonNegativeIntegertoStrurlMirrorzipCDNImage Source: zipCDNImage.js import { imageUtil as ImageUtil } from './base/image'; import { objectAssign } from './base/object'; let globalOptions = {}; /** * 设置全局配置，options会被assign进globaOptions * @param {Object} options extendGlobalOptions */ function setGlobalOptions(options) { objectAssign(globalOptions, options); } /** * 获取全局配置 * @return {Object} globalOptions */ function getGlobalOptions() { return globalOptions; } // 初始化new一下（可放在循环外） const image = new ImageUtil(); /** * 获取压缩后的cdn图片地址 * @param {String} imageUrl 图片地址 * @param {Object} options 配置 * @return {String} 压缩后的图片地址 * * e.g. * zipCDNImage(imageUrl, { * width: 355, * height: 221, * }) */ function zipCDNImage(imageUrl, options) { return image.getRectImageUrl(objectAssign({ suffixName: image.getSuffixName(imageUrl), imageUrl, }, globalOptions, options)); } export { setGlobalOptions, getGlobalOptions, }; export default zipCDNImage; × Search results Close Documentation generated by JSDoc 3.4.3 on 2018-01-16T14:37:15+08:00 using the DocStrap template. "},"router.js.html":{"id":"router.js.html","title":"Source: router.js","body":" @2dfire/utils Classes imageUtil Global arrayFindarrayFindIndexarrayUniqueclonecreateUrldFireFetchdFireFetchWithoutGlobalenterSocketRoomextractgetGlobalOptionsgetRealUrlisArrayisEmptyisFunctionisJsonisMobilePhoneisNullisNumberisObjectisStringisUndefinednavigateBacknavigateTonumberFixedFennumberFixedYuannumberFormatobjectAssignobjectForEachobjectMapparseparseMessageredirectToselectKeyssetGlobalOptionssetSocketGlobalOptionssetUrlMirrorstartWithstringifystringifyMessagestringTrimstringTrimLeftstringTrimRighttoInttoIntBooltoJsontoNonNegativeIntegertoStrurlMirrorzipCDNImage Source: router.js import location from 'PLATFORM/location'; import qs from './base/qs'; import { createUrl } from './base/url'; import { objectAssign } from './base/object'; /** * 地址转换(可选) * example: * let urlMirror = [ * { * keyword: &quot;/shop/page/&quot;, * url: &quot;/pages/menu/menu&quot; * } * ]; */ let urlMirror = undefined; /** * 设置地址转换的镜像对象 * @param {Object} mirror 镜像对象 */ function setUrlMirror (mirror) { if (mirror) { urlMirror = mirror } } /** * 获取真实地址 * @param {String} baseUrl 跳转地址 * @return {String} 镜像匹配后的地址 */ function getRealUrl (baseUrl) { if(!urlMirror) { return baseUrl } let realUrl = &quot;&quot;; var urlList = baseUrl.split(&quot;?&quot;) || []; var params = urlList[1]; for(let value of urlMirror) { if(baseUrl.search(value.keyword) &gt;= 0) { realUrl = value.url; break } } if(realUrl) { realUrl = realUrl + (params ? `?${params}` : &quot;&quot;) } else { realUrl = baseUrl } return realUrl } /** * 地址转跳 * @param {String} baseUrl 跳转地址 * @param {Object} params key-value 对象,选填 * @param {Integer} delay 延迟跳转选填 * @return {void} */ function navigateTo (baseUrl, params = {}, delay = 0) { baseUrl = getRealUrl(baseUrl); if (delay &gt; 0) { setTimeout(() =&gt; navigateTo(baseUrl, params), delay); } else { location.navigateTo(createUrl(baseUrl, params)); } } /** * 地址转跳,replace形式 * @param {String} baseUrl 跳转地址 * @param {Object} params key-value 对象,选填 * @param {Integer} delay 延迟跳转选填 * @return {void} */ function redirectTo (baseUrl, params = {}, delay = 0) { baseUrl = getRealUrl(baseUrl); if (delay &gt; 0) { setTimeout(() =&gt; redirectTo(baseUrl, params), delay); } else { location.redirectTo(createUrl(baseUrl, params)); } } /** * 地址回退 * @param {Integer} n 回退步数 * @param {Integer} delay 延迟跳转选填 * @return {void} */ function navigateBack(n, delay = 0) { if (delay &gt; 0) { setTimeout(() =&gt; navigateBack(n), delay); } else { location.navigateBack(n); } } // route let oldQueryStr = ''; let oldQuery = {}; const route = { /** * search string * @type {String} */ get search () { return location.search; }, /** * hash string * @type {String} */ get hash () { return location.hash; }, /** * href string * @type {String} */ get href () { return location.href; }, set href (href) { location.href = href; }, /** * 从url中取来的参数 * @type {Object} */ get query () { const search = location.search; let hash = location.hash; const newQueryStr = search + hash; if ( oldQueryStr === newQueryStr) { return oldQuery; } oldQueryStr = newQueryStr; if (hash.indexOf('?') !== -1) { hash = qs.extract(hash); } return oldQuery = objectAssign({ }, qs.parse(search), qs.parse(hash) ); } }; export { navigateTo, redirectTo, navigateBack, getRealUrl, setUrlMirror, route }; export default { navigateTo, redirectTo, navigateBack, getRealUrl, setUrlMirror, route }; × Search results Close Documentation generated by JSDoc 3.4.3 on 2018-01-16T14:37:15+08:00 using the DocStrap template. "},"base_image.js.html":{"id":"base_image.js.html","title":"Source: base/image.js","body":" @2dfire/utils Classes imageUtil Global arrayFindarrayFindIndexarrayUniqueclonecreateUrldFireFetchdFireFetchWithoutGlobalenterSocketRoomextractgetGlobalOptionsgetRealUrlisArrayisEmptyisFunctionisJsonisMobilePhoneisNullisNumberisObjectisStringisUndefinednavigateBacknavigateTonumberFixedFennumberFixedYuannumberFormatobjectAssignobjectForEachobjectMapparseparseMessageredirectToselectKeyssetGlobalOptionssetSocketGlobalOptionssetUrlMirrorstartWithstringifystringifyMessagestringTrimstringTrimLeftstringTrimRighttoInttoIntBooltoJsontoNonNegativeIntegertoStrurlMirrorzipCDNImage Source: base/image.js /** * Created by hongpao on 2017/9/26. */ /** * 关于图片的处理 * @param options * */ class imageUtil { getSuffixName(imageUrl) { //图片地址 imageUrl = imageUrl || ''; //获取图片地址的后缀名 let imageUrlAry = imageUrl.split('.'); let lastIndex = imageUrlAry.length - 1; let suffixName = imageUrlAry[lastIndex]; if (suffixName === 'png') { return 'jpg'; } else { return suffixName; } } getRectImageUrl(options) { options = options || {}; let imageUrl = options.imageUrl || ''; let source = options.source || 1; //来源判断(1:H5, 2小程序) let defaultImageUrl = 'http://d.2dfire.com/file/images/menulist/default-large.png'; let rightFlag = true; //图片地址协议处理 if (imageUrl &amp;&amp; imageUrl.length &gt; 0) { if (imageUrl.substr(0, 5) === 'https') { imageUrl.replace(&quot;https:&quot;, &quot;&quot;); } else if (imageUrl.substr(0, 4) === 'http') { imageUrl.replace(&quot;http:&quot;, &quot;&quot;); } else { imageUrl = `//${imageUrl}`; } } else { rightFlag = false; } if (rightFlag) { let subUrl = ''; let index = 0; //老图片地址的处理 //http://rest3.zm1717.com/upload_files/00031985/menu/84d4ea26438063fcdf6162b41c79d932.png let flagStr = &quot;upload_files&quot;; if (imageUrl.indexOf(flagStr) &gt; -1) { index = imageUrl.indexOf(flagStr) + flagStr.length + 1; imageUrl = imageUrl.replace(&quot;_s&quot;, &quot;&quot;); subUrl = imageUrl.substring(index, imageUrl.length); } //新图片地址的处理 //http://ifile.2dfire.com/00031985/menu/be4c0716b89e47869cc0d4b610d211e4.jpg let newFlagStr = ['ifile.2dfire.com', 'ifiletest.2dfire.com', 'file1.2dfire.com']; newFlagStr.map((item) =&gt; { if (imageUrl.indexOf(item) &gt; -1) { index = imageUrl.indexOf(item) + item.length + 1; subUrl = imageUrl.substring(index, imageUrl.length); } }); //默认图片的宽高设置 let width = options.width || 144; let height = options.height || 144; //有些图片不需要裁剪，要等比缩放 let h = (height !== -1) ? (&quot;_&quot; + height + &quot;h&quot;) : &quot;&quot;; // 新增分辨率判断 let ratio; if (source !== 2) { ratio = window.devicePixelRatio || 2; ratio = ratio === 3 ? 2 : ratio; //降级 } else { ratio = 2; } //图片质量 let quality = options.quality || 80; //图片后缀名的判断 let imgUrlArr = subUrl.split('.'); let l = imgUrlArr.length; //图片后缀名 let suffixName = options.suffixName || imgUrlArr[l - 1]; //图片是否支持webp格式 let isWebpSupport = options.isWebpSupport || false; //gif图是否显示动图（默认是） let isShowGif = options.isShowGif || true; /** * gif图特殊处理（默认动图） * 其他图片判断是否支付webp */ if (suffixName === 'gif') { if (!isShowGif) { suffixName = isWebpSupport ? 'webp' : 'jpg'; } } else { suffixName = isWebpSupport ? 'webp' : suffixName; } //不同环境下的域名地址 let imageBaseUrl = options.imageBaseUrl || '//ifile.2dfire.com/'; imageUrl = `${imageBaseUrl}${subUrl}@1e_${width}w${h}_1c_0i_0o_${quality}Q_${ratio}x.${suffixName}`; } //有图片地址，并且格式正确，则返回处理后的图片地址，否则返回默认图片地址； if (rightFlag) { return imageUrl; } else { if (source !== 2) { return defaultImageUrl; } else { return ''; } } } } export { imageUtil }; export default { imageUtil }; × Search results Close Documentation generated by JSDoc 3.4.3 on 2018-01-16T14:37:15+08:00 using the DocStrap template. "},"platforms_wxApp_io.js.html":{"id":"platforms_wxApp_io.js.html","title":"Source: platforms/wxApp/io.js","body":" @2dfire/utils Classes imageUtil Global arrayFindarrayFindIndexarrayUniqueclonecreateUrldFireFetchdFireFetchWithoutGlobalenterSocketRoomextractgetGlobalOptionsgetRealUrlisArrayisEmptyisFunctionisJsonisMobilePhoneisNullisNumberisObjectisStringisUndefinednavigateBacknavigateTonumberFixedFennumberFixedYuannumberFormatobjectAssignobjectForEachobjectMapparseparseMessageredirectToselectKeyssetGlobalOptionssetSocketGlobalOptionssetUrlMirrorstartWithstringifystringifyMessagestringTrimstringTrimLeftstringTrimRighttoInttoIntBooltoJsontoNonNegativeIntegertoStrurlMirrorzipCDNImage Source: platforms/wxApp/io.js import { isEmpty } from &quot;../../base/object&quot; const EventEmitter = require('events'); /** * 序列化消息 * @param {String} name 事件名称 * @param {Any} payload 数据 * @return {String} 序列化后的消息 */ function stringifyMessage(name, payload) { return name + (payload ? JSON.stringify(payload) : &quot;&quot;); } /** * 解析服务端传来的message * @param {String} message 服务端传来的message * * @return {Object} 解析后消息{ name, payload } name: 表示事件名字, payload: 数据 */ function parseMessage(data) { if (isEmpty(data)) { console.log(&quot;onSocketMessage: data 不能为空&quot;); return; } var result = data.replace(&quot;42/web_socket,&quot;, &quot;&quot;) || &quot;&quot;; var message = result ? JSON.parse(result) : []; // TODO 解析socket.io的message if (!message[0]) { console.log(&quot;onSocketMessage: message 不能为空&quot;); return; } return { name: message[0] || &quot;&quot;, payload: typeof message[1] === &quot;string&quot; ? JSON.parse(message[1] || &quot;{}&quot;) : message[1] }; } class Io { constructor() { wx.onSocketOpen(res =&gt; { console.log('WebSocket连接已打开！'); setTimeout(() =&gt; { this.eventEmitter.emit('connect', res); }, 2000); this.actived = true; }); wx.onSocketError(res =&gt; { console.log('WebSocket连接打开失败，请检查！'); this.eventEmitter.emit('connect_error', res); this.actived = false; }); wx.onSocketClose(res =&gt; { console.log('WebSocket 已关闭！'); this.eventEmitter.emit('disconnect', res); this.actived = false; }); wx.onSocketMessage(res =&gt; { console.log(&quot;res: &quot;, res); const data = res.data; if (!data) { return; } else if (data.search(&quot;pingInterval&quot;) &gt;= 0) { return; } else if (data === &quot;40&quot;) { this.send(&quot;40/web_socket&quot;); } else if (data === &quot;3&quot;) { return; } else if (data === &quot;40/web_socket&quot;) { clearInterval(this.intervalIndex); this.intervalIndex = setInterval(() =&gt; { this.send(&quot;2&quot;); }, 25000); } else { const message = parseMessage(data); this.eventEmitter.emit(message.name, message.payload); } }); } send(name, payload) { wx.sendSocketMessage({ data: stringifyMessage(name, payload) }); return this; } /** * 监听事件 * ！！！注意这里会移除原来所有事件！！！意味着一个事件只有一处监听 * @param {String} eventName 事件名字 * @param {Function} listener 事件处理 * @return {Io} this */ on(eventName, listener) { this.removeAll(eventName); this.eventEmitter.on(eventName, listener); return this; } remove(eventName, listener) { this.eventEmitter.removeListener(eventName, listener); return this; } removeAll(eventName) { this.eventEmitter.removeAllListeners(eventName); return this; } once(eventName, listener) { this.eventEmitter.once(eventName, listener); return this; } close() { this.actived = false; clearInterval(this.intervalIndex); wx.closeSocket(); return this; } connect() { this.actived = true; console.log(&quot;io.options: &quot;, this.options); console.log(&quot;io.url: &quot;, this.url); wx.connectSocket({ url: this.url, data: this.options, header: { 'content-type': 'application/json' }, method: &quot;GET&quot; }); return this; } reopen(url, options) { // 清空事件 this.eventEmitter = new EventEmitter(); this.url = url; this.options = options || {}; return this.connect(); } } // Io实例，全局只实例一次 let __instance = undefined; export default function io (url, options, isNew) { if (!__instance) { __instance = new Io(); } /** * 以下情况时会重新open，会清除之前绑定的事件 * 1. isNew为true * 3. 此次url和现在url不同 */ if (isNew || url !== __instance.url) { __instance.reopen(url, options); } else if (!__instance.actived) { /** * 以下情况时同时存在时会重新链接，不会清除之前绑定的事件 * 1. 当前不活跃 * 2. isNew不为true * 3. 此次url和现在url相同 */ __instance.connect(); } return __instance; } × Search results Close Documentation generated by JSDoc 3.4.3 on 2018-01-16T14:37:15+08:00 using the DocStrap template. "},"base_validate.js.html":{"id":"base_validate.js.html","title":"Source: base/validate.js","body":" @2dfire/utils Classes imageUtil Global arrayFindarrayFindIndexarrayUniqueclonecreateUrldFireFetchdFireFetchWithoutGlobalenterSocketRoomextractgetGlobalOptionsgetRealUrlisArrayisEmptyisFunctionisJsonisMobilePhoneisNullisNumberisObjectisStringisUndefinednavigateBacknavigateTonumberFixedFennumberFixedYuannumberFormatobjectAssignobjectForEachobjectMapparseparseMessageredirectToselectKeyssetGlobalOptionssetSocketGlobalOptionssetUrlMirrorstartWithstringifystringifyMessagestringTrimstringTrimLeftstringTrimRighttoInttoIntBooltoJsontoNonNegativeIntegertoStrurlMirrorzipCDNImage Source: base/validate.js const mobilePhoneReg = /^1[3|4|5|7|8]\\d{9}$/; /** * 检验字符串是否符合手机规则 * @param {String} v * @return {Boolean} */ function isMobilePhone (v) { return mobilePhoneReg.test(v); } export { isMobilePhone }; export default { isMobilePhone }; × Search results Close Documentation generated by JSDoc 3.4.3 on 2018-01-16T14:37:15+08:00 using the DocStrap template. "},"base_number.js.html":{"id":"base_number.js.html","title":"Source: base/number.js","body":" @2dfire/utils Classes imageUtil Global arrayFindarrayFindIndexarrayUniqueclonecreateUrldFireFetchdFireFetchWithoutGlobalenterSocketRoomextractgetGlobalOptionsgetRealUrlisArrayisEmptyisFunctionisJsonisMobilePhoneisNullisNumberisObjectisStringisUndefinednavigateBacknavigateTonumberFixedFennumberFixedYuannumberFormatobjectAssignobjectForEachobjectMapparseparseMessageredirectToselectKeyssetGlobalOptionssetSocketGlobalOptionssetUrlMirrorstartWithstringifystringifyMessagestringTrimstringTrimLeftstringTrimRighttoInttoIntBooltoJsontoNonNegativeIntegertoStrurlMirrorzipCDNImage Source: base/number.js /** * old: `WXUtil.format_number` * 格式化的数字, 四舍五入保留两位小数 * @param {Number} pnumber 需要格式化的数字 * @return {String} 保留两位小数的字符串 * @example * numberFormat(20.495) // 20.50 * numberFormat(20.494) // 20.49 * numberFormat(-20.495) // -20.50 * numberFormat(-20.494) // -20.49 * numberFormat('asd') // 0.00 * numberFormat(true) // 0.00 */ function numberFormat (number) { if (Number.isNaN(+(number + ''))) { return '0.00'; } return ( Math.round(Math.abs(number) * 100) / (number &lt; 0 ? -100: 100) ).toFixed(2); } /** * old: `AppUtil.fixedFenMoney` * 格式化支付金额（字符串，单位分）,numberFormat有四舍五入的功能 * @param {Number|String} m 需要格式化的数字（单位分） * @return {String} 保留两位小数的字符串 */ function numberFixedFen (m) { return numberFormat(m / 100); } /** * old: `AppUtil.fixedYuanMoney` * 格式化支付金额（字符串，单位元）,numberFormat有四舍五入的功能 * @param {Number|String} m 需要格式化的数字（单位元） * @return {String} 保留两位小数的字符串 */ function numberFixedYuan (m) { return numberFormat(m); } /** * 转换为非负整数 * @param {Number|String} num 需要转换的数 * @return {Integer} 转换后的数 */ function toNonNegativeInteger (num) { if (Number.isNaN(+(num + ''))) { return 0; } return Math.max(parseInt(num, 10), 0); } export { numberFormat, numberFixedFen, numberFixedYuan, toNonNegativeInteger }; export default { numberFormat, numberFixedFen, numberFixedYuan, toNonNegativeInteger }; × Search results Close Documentation generated by JSDoc 3.4.3 on 2018-01-16T14:37:15+08:00 using the DocStrap template. "},"base_string.js.html":{"id":"base_string.js.html","title":"Source: base/string.js","body":" @2dfire/utils Classes imageUtil Global arrayFindarrayFindIndexarrayUniqueclonecreateUrldFireFetchdFireFetchWithoutGlobalenterSocketRoomextractgetGlobalOptionsgetRealUrlisArrayisEmptyisFunctionisJsonisMobilePhoneisNullisNumberisObjectisStringisUndefinednavigateBacknavigateTonumberFixedFennumberFixedYuannumberFormatobjectAssignobjectForEachobjectMapparseparseMessageredirectToselectKeyssetGlobalOptionssetSocketGlobalOptionssetUrlMirrorstartWithstringifystringifyMessagestringTrimstringTrimLeftstringTrimRighttoInttoIntBooltoJsontoNonNegativeIntegertoStrurlMirrorzipCDNImage Source: base/string.js /** * 清除字符串两边空格 * @param {String} str * @return {String} */ function stringTrim (str) { return str.replace(/^\\s*|\\s*$/g, ''); } /** * 清除字符串左边空格 * @param {String} str * @return {String} */ function stringTrimLeft (str) { return str.replace(/^\\s*/, ''); } /** * 清除字符串右边空格 * @param {String} str * @return {String} */ function stringTrimRight (str) { return str.replace(/\\s*$/, ''); } /** * 字符是否以compareStr开头 * @param {String} str * @param {String} compareStr * @return {Boolean} */ function startWith (str, compareStr) { return str.indexOf(compareStr) === 0; } /** * 转换为int类型 * @param {String} str * @return {Boolean} */ function toInt( str ){ let num = parseInt(str); return isNaN( num ) ? 0 : num; } /** * 转换为int类型的1或0 * @param {String} str * @return {Boolean} */ function toIntBool( str ){ let bool = str; if ( typeof(str) == 'string'){ bool = toInt(str); } return bool ? 1 : 0; } // polyfill startWith if (!String.prototype.startWith) { String.prototype.startWith = function(compareStr) { return startWith(this, compareStr); } } /** * old: `type.toJson` * 字符串转为对象 * @param {String} v 需要parse的字符串 * @return {Object} */ function toJson(v, defaultValue = {}){ try { return JSON.parse(v) || defaultValue; } catch(e){ return {}; } } export { stringTrim, stringTrimLeft, stringTrimRight, startWith, toInt, toIntBool, toJson }; export default { stringTrim, stringTrimLeft, stringTrimRight, startWith, toInt, toIntBool, toJson }; × Search results Close Documentation generated by JSDoc 3.4.3 on 2018-01-16T14:37:15+08:00 using the DocStrap template. "},"global.html":{"id":"global.html","title":"Global","body":" @2dfire/utils Classes imageUtil Global arrayFindarrayFindIndexarrayUniqueclonecreateUrldFireFetchdFireFetchWithoutGlobalenterSocketRoomextractgetGlobalOptionsgetRealUrlisArrayisEmptyisFunctionisJsonisMobilePhoneisNullisNumberisObjectisStringisUndefinednavigateBacknavigateTonumberFixedFennumberFixedYuannumberFormatobjectAssignobjectForEachobjectMapparseparseMessageredirectToselectKeyssetGlobalOptionssetSocketGlobalOptionssetUrlMirrorstartWithstringifystringifyMessagestringTrimstringTrimLeftstringTrimRighttoInttoIntBooltoJsontoNonNegativeIntegertoStrurlMirrorzipCDNImage Global Members &lt;constant&gt; extract 从url中取出能被转化的query string Source: base/qs.js Example extract(search); // 'chain_id=9&amp;lottery_activity_id=b' &lt;constant&gt; isArray 判断是否是数组 Source: base/object.js &lt;constant&gt; objectAssign 用于将所有可枚举的属性的值从一个或多个源对象复制到目标对象。它将返回目标对象。 objectAssign(target, ...sources) Source: base/object.js Example objectAssign({ a: 1, b: 2 }, { a: 3, c: 4 }); // { a: 3, b: 2, c: 4 } &lt;constant&gt; parse query string 转化为对象 Source: base/qs.js Example parse(&quot;a=123&quot;); // { a: 123 } parse(&quot;a=%5B1%5D&quot;); // { a: &quot;[1]&quot; } urlMirror 地址转换(可选) example: let urlMirror = [ { keyword: &quot;/shop/page/&quot;, url: &quot;/pages/menu/menu&quot; } ]; Source: router.js Methods arrayFind(arr, predicate) 数组find,数组中满足提供的测试函数的第一个元素的值 Parameters: Name Type Description arr Array 数组 predicate function 在数组每一项上执行的函数 Source: base/array.js See: also https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/find Returns: 满足提供的测试函数的第一个元素的值,否则返回 undefined Type Any arrayFindIndex(arr, predicate) 数组find,返回数组中满足提供的测试函数的第一个元素的索引 Parameters: Name Type Description arr Array 数组 predicate function 在数组每一项上执行的函数 Source: base/array.js See: also https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/findIndex Returns: 满足提供的测试函数的第一个元素的索引。否则返回-1 Type Number arrayUnique(arr) 数组去重 Parameters: Name Type Description arr Array Source: base/array.js Returns: 去重后数组 Type Array clone(o) 深层次clone Parameters: Name Type Description o Any 需要clone的对象 Source: base/object.js Returns: clone后的对象 Type Any createUrl(baseUrl, params) 创建一个地址附带查询参数 Parameters: Name Type Description baseUrl String 基础地址 params Object key-value 对象,选填 Source: base/url.js Returns: Type void dFireFetch(options) fetch，将实例化FireFetch，并且执行FireFetch.doFetch Parameters: Name Type Description options Object 请求配置 Source: fetch.js Returns: Type Promise dFireFetchWithoutGlobal(options) 没有全局信息的fetch Parameters: Name Type Description options Object 请求配置 Source: fetch.js Returns: Type Promise enterSocketRoom(room) 根据room链接socket。如果没有room参数，默认进入全局默认房间 TODO 之后支持多房间 Parameters: Name Type Description room Object 需要链接房间 Source: socket.js Returns: socket实例 Type Io getGlobalOptions() 获取全局配置 Source: zipCDNImage.js Returns: globalOptions Type Object getRealUrl(baseUrl) 获取真实地址 Parameters: Name Type Description baseUrl String 跳转地址 Source: router.js Returns: 镜像匹配后的地址 Type String isEmpty(任意对象) isEmpty 是否为空 Parameters: Name Type Description 任意对象 obj Source: base/object.js Returns: true/false Type bol isFunction(v) 判断是否是方法 Parameters: Name Type Description v Any Source: base/object.js Returns: true表示是方法,false表示不是 Type Boolean isJson(v) 测试对象是否是纯粹的对象（通过 &quot;{}&quot; 或者 &quot;new Object&quot; 创建的） Parameters: Name Type Description v Any Source: base/object.js Returns: true表示是,false表示不是 Type Boolean isMobilePhone(v) 检验字符串是否符合手机规则 Parameters: Name Type Description v String Source: base/validate.js Returns: Type Boolean isNull(v) 判断是否是null Parameters: Name Type Description v Any Source: base/object.js Returns: true表示是null,false表示不是 Type Boolean isNumber(v) 判断是否是数字 Parameters: Name Type Description v Any Source: base/object.js Returns: true表示是数字,false表示不是 Type Boolean isObject(v) 测试是否是对象 Parameters: Name Type Description v Any Source: base/object.js Returns: true表示是,false表示不是 Type Boolean isString(v) 判断是否是字符串 Parameters: Name Type Description v Any Source: base/object.js Returns: true表示是字符串,false表示不是 Type Boolean isUndefined(v) 判断是否是undefined Parameters: Name Type Description v Any Source: base/object.js Returns: true表示是undefined,false表示不是 Type Boolean navigateBack(n, delay) 地址回退 Parameters: Name Type Default Description n Integer 回退步数 delay Integer 0 延迟跳转选填 Source: router.js Returns: Type void navigateTo(baseUrl, params, delay) 地址转跳 Parameters: Name Type Default Description baseUrl String 跳转地址 params Object key-value 对象,选填 delay Integer 0 延迟跳转选填 Source: router.js Returns: Type void numberFixedFen(m) old: `AppUtil.fixedFenMoney` 格式化支付金额（字符串，单位分）,numberFormat有四舍五入的功能 Parameters: Name Type Description m Number | String 需要格式化的数字（单位分） Source: base/number.js Returns: 保留两位小数的字符串 Type String numberFixedYuan(m) old: `AppUtil.fixedYuanMoney` 格式化支付金额（字符串，单位元）,numberFormat有四舍五入的功能 Parameters: Name Type Description m Number | String 需要格式化的数字（单位元） Source: base/number.js Returns: 保留两位小数的字符串 Type String numberFormat(pnumber) old: `WXUtil.format_number` 格式化的数字, 四舍五入保留两位小数 Parameters: Name Type Description pnumber Number 需要格式化的数字 Source: base/number.js Returns: 保留两位小数的字符串 Type String Example numberFormat(20.495) // 20.50 numberFormat(20.494) // 20.49 numberFormat(-20.495) // -20.50 numberFormat(-20.494) // -20.49 numberFormat('asd') // 0.00 numberFormat(true) // 0.00 objectForEach(obj, cb) 对象forEach方法 Parameters: Name Type Description obj Object cb function 将被循环执行 currentValue callback 的第一个参数，数组中当前被传递的元素。 index callback 的第二个参数，数组中当前被传递的元素的索引。 obj callback 的第三个参数，调用 map 方法的对象。 Source: base/object.js Returns: Type Void objectMap(obj, cb) 对象map方法 Parameters: Name Type Description obj Object cb function 原数组中的元素经过该方法后返回一个新的元素。 currentValue callback 的第一个参数，数组中当前被传递的元素。 index callback 的第二个参数，数组中当前被传递的元素的索引。 obj callback 的第三个参数，调用 map 方法的对象。 Source: base/object.js Returns: Type Object parseMessage(message) 解析服务端传来的message Parameters: Name Type Description message String 服务端传来的message Source: platforms/wxApp/io.js Returns: 解析后消息{ name, payload } name: 表示事件名字, payload: 数据 Type Object redirectTo(baseUrl, params, delay) 地址转跳,replace形式 Parameters: Name Type Default Description baseUrl String 跳转地址 params Object key-value 对象,选填 delay Integer 0 延迟跳转选填 Source: router.js Returns: Type void selectKeys(obj, ks) add by suanrong 使用obj中的ks组成新对象并返回 Parameters: Name Type Description obj Object ks [k1,k2,k3] Source: base/object.js setGlobalOptions(sessionOutHandler) 设置全局会话超时处理 Parameters: Name Type Description sessionOutHandler function Source: fetch.js setGlobalOptions(options) 设置全局配置，options会被assign进globaOptions Parameters: Name Type Description options Object extendGlobalOptions Source: zipCDNImage.js setSocketGlobalOptions(sessionOutHandler) 设置全局会话超时处理 Parameters: Name Type Description sessionOutHandler function Source: socket.js setUrlMirror(mirror) 设置地址转换的镜像对象 Parameters: Name Type Description mirror Object 镜像对象 Source: router.js startWith(str, compareStr) 字符是否以compareStr开头 Parameters: Name Type Description str String compareStr String Source: base/string.js Returns: Type Boolean stringify(params) 简单对象转化为query string,如果参数是对象使用JSON.parse转换 Parameters: Name Type Description params Object 参数 key-value Source: base/qs.js Returns: Type String Example stringify({ a: 123 }); // &quot;a=123&quot; stringify({ a: [1] }); // &quot;a=%5B1%5D&quot; stringifyMessage(name, payload) 序列化消息 Parameters: Name Type Description name String 事件名称 payload Any 数据 Source: platforms/wxApp/io.js Returns: 序列化后的消息 Type String stringTrim(str) 清除字符串两边空格 Parameters: Name Type Description str String Source: base/string.js Returns: Type String stringTrimLeft(str) 清除字符串左边空格 Parameters: Name Type Description str String Source: base/string.js Returns: Type String stringTrimRight(str) 清除字符串右边空格 Parameters: Name Type Description str String Source: base/string.js Returns: Type String toInt(str) 转换为int类型 Parameters: Name Type Description str String Source: base/string.js Returns: Type Boolean toIntBool(str) 转换为int类型的1或0 Parameters: Name Type Description str String Source: base/string.js Returns: Type Boolean toJson(v) old: `type.toJson` 字符串转为对象 Parameters: Name Type Description v String 需要parse的字符串 Source: base/string.js Returns: Type Object toNonNegativeInteger(num) 转换为非负整数 Parameters: Name Type Description num Number | String 需要转换的数 Source: base/number.js Returns: 转换后的数 Type Integer toStr() add by hupo 转换为string Source: base/object.js zipCDNImage(imageUrl, options) 获取压缩后的cdn图片地址 Parameters: Name Type Description imageUrl String 图片地址 options Object 配置 Source: zipCDNImage.js Returns: 压缩后的图片地址 e.g. zipCDNImage(imageUrl, { width: 355, height: 221, }) Type String × Search results Close Documentation generated by JSDoc 3.4.3 on 2018-01-16T14:37:15+08:00 using the DocStrap template. "},"classes.list.html":{"id":"classes.list.html","title":"Classes","body":" @2dfire/utils Classes imageUtil Global arrayFindarrayFindIndexarrayUniqueclonecreateUrldFireFetchdFireFetchWithoutGlobalenterSocketRoomextractgetGlobalOptionsgetRealUrlisArrayisEmptyisFunctionisJsonisMobilePhoneisNullisNumberisObjectisStringisUndefinednavigateBacknavigateTonumberFixedFennumberFixedYuannumberFormatobjectAssignobjectForEachobjectMapparseparseMessageredirectToselectKeyssetGlobalOptionssetSocketGlobalOptionssetUrlMirrorstartWithstringifystringifyMessagestringTrimstringTrimLeftstringTrimRighttoInttoIntBooltoJsontoNonNegativeIntegertoStrurlMirrorzipCDNImage Classes Classes imageUtil × Search results Close Documentation generated by JSDoc 3.4.3 on 2018-01-16T14:37:15+08:00 using the DocStrap template. "},"index.html":{"id":"index.html","title":"Index","body":" @2dfire/utils Classes imageUtil Global arrayFindarrayFindIndexarrayUniqueclonecreateUrldFireFetchdFireFetchWithoutGlobalenterSocketRoomextractgetGlobalOptionsgetRealUrlisArrayisEmptyisFunctionisJsonisMobilePhoneisNullisNumberisObjectisStringisUndefinednavigateBacknavigateTonumberFixedFennumberFixedYuannumberFormatobjectAssignobjectForEachobjectMapparseparseMessageredirectToselectKeyssetGlobalOptionssetSocketGlobalOptionssetUrlMirrorstartWithstringifystringifyMessagestringTrimstringTrimLeftstringTrimRighttoInttoIntBooltoJsontoNonNegativeIntegertoStrurlMirrorzipCDNImage @2dfire/utils 0.2.64 通用工具库通用工具库(文档待完善) Installation$ npm i @2dfire/utils --save-dev@2dfire为私库前缀，请参考npm私库使用办法 Usage// 引入所有 import Utils, { object, localStorage } from &quot;@2dfire/utils&quot;; // 打包 utils 所有文件进来 Utils.object.clone({ foo: 1 }); object.clone({ foo: 1 }); // 引入utils/object import object, { clone } from &quot;@2dfire/utils/object&quot;; // 只会打包 object.js进来 object.clone({ foo: 1 }); clone({ foo: 1 });小程序打包兼容代码设置办法 在业务中依然用@2dfire/utils，在业务的webpack添加alias如下: module.exports = { resolve: { alias: { &quot;@2dfire/utils&quot;: &quot;@2dfire/utils/wxApp&quot; } } };目录说明 src 开发目录 build webpack打包相关 test 测试相关内容说明一级工具目录说明 工具集 说明 备注 index 所有工具集合/ main 包括小程序版本 array 数组类型相关方法 date 日期类型相关方法 object object和其他所有类型相关方法 string 字符串类型相关方法 number 数字类型相关方法 route 路由相关方法 包括小程序版本 qs url参数获取相关方法 包括小程序版本 url URL相关方法 包括小程序版本 validate 验证相关方法 seesionStorage seesionStorage相关方法 包括小程序版本 localStorage localStorage相关方法 包括小程序版本 cookie cookie相关方法 包括小程序版本 storage &amp; cookie说明一起都在下方，其它辅助方法文档可以访问这里 storage &amp; cookieapis各平台的storage &amp; cookie都实现这六个方法： set(name, value, [attributes]): 将属性设置到Storage,设置前JSON.stringify。无返回 setItem(name, value, [attributes]): 将属性设置到storage。无返回 get(name): 从storage获取属性，并且JSON.parse。返回取到的值进行JSON.parse()转化后的值 getItem(name): 从storage获取属性。返回取到的值 removeItem(name, [attributes]): 从storage移除属性。无返回 clear([attributes]): 清空storage。无返回 参数说明 name: String 设置名称,会被转换为字符串 value setItem: String,其余类型值会被转为String set: Any 值,全部JSON.stringify attributes: cookie属性 expires: 过期时间 单位天 path: 地址如'/shop/page' domain: 域 secure: 是否需要https attributes实际上只有在web下起作用，小程序环境下cookie是假的，保存在内存中，如果需要长久存储，请选择localStorage 推荐：在已知类型情况下，使用set和get。如果未知类型，可能其它地方设置了， 请使用setItem、getItem，来设置获取字符串。 各平台下api实际实现情况说明 类型 平台 实现 seesionStorage web 正常 localStorage web 正常 cookie web 正常, 使用 js-cookie 库 seesionStorage 小程序 保存在内存中 localStorage 小程序 wx的Storage cookie 小程序 保存在内存中 exampleimport storage from '@2dfire/utils/localStorage'; storage.set('coolName', { a: 'booo' }); // values: { a: '&quot;booo&quot;'} // 和原生Storage(e.g. localStorage) getItem一致 storage.getItem('coolName'); // String: '{&quot;a&quot;:&quot;booo&quot;}' // 将通过JSON.parse转化为对象,如果回去到的值不为JSON字符串，则throw Uncaught SyntaxError storage.get('coolName'); // Object: { a: 'booo' } storage.setItem('coolName', { a: 'booo' }); // 和原生Storage(e.g. localStorage) setItem一致 storage.getItem('coolName'); // String: '[object Object]' storage.get('coolName'); // throw Uncaught SyntaxError storage.getItem('unsetName'); // null 这里和原生Storage的getItem一致，原生返回nullTODOs功能 globalBasePage analytics 单元测试 cover: 97.41% Statements 113/116 92.31% Branches 48/52 96.67% Functions 29/30 97.41% Lines 113/116 [x] base [x] array.js [x] date.js [x] object.js [x] qs.js [x] string.js [x] number.js [x] url.js [x] validate.js [x] utils [x] createStorage.js [ ] platforms [ ] web [ ] ajax.js [ ] analytics.js [x] cookie.js [x] promise.js [ ] globalBasePage.js [x] localStorage.js [x] location.js [x] sessionStorage.js [ ] window.js [ ] wxApp 暂时没有办法单元测试 [ ] ajax.js [ ] analytics.js [ ] cookie.js [x] promise.js [ ] globalBasePage.js [ ] localStorage.js [ ] location.js [ ] query.js [ ] sessionStorage.js [x] router.js [ ] fetch.js × Search results Close Documentation generated by JSDoc 3.4.3 on 2018-01-16T14:37:15+08:00 using the DocStrap template. "},"imageUtil.html":{"id":"imageUtil.html","title":"Class: imageUtil","body":" @2dfire/utils Classes imageUtil Global arrayFindarrayFindIndexarrayUniqueclonecreateUrldFireFetchdFireFetchWithoutGlobalenterSocketRoomextractgetGlobalOptionsgetRealUrlisArrayisEmptyisFunctionisJsonisMobilePhoneisNullisNumberisObjectisStringisUndefinednavigateBacknavigateTonumberFixedFennumberFixedYuannumberFormatobjectAssignobjectForEachobjectMapparseparseMessageredirectToselectKeyssetGlobalOptionssetSocketGlobalOptionssetUrlMirrorstartWithstringifystringifyMessagestringTrimstringTrimLeftstringTrimRighttoInttoIntBooltoJsontoNonNegativeIntegertoStrurlMirrorzipCDNImage Class: imageUtil imageUtil 关于图片的处理 new imageUtil(options) Parameters: Name Type Description options Source: base/image.js × Search results Close Documentation generated by JSDoc 3.4.3 on 2018-01-16T14:37:15+08:00 using the DocStrap template. "}}
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            Searcher.init();
        });

        $(window).on("message", function(msg) {
            var msgData = msg.originalEvent.data;

            if (msgData.msgid != "docstrap.quicksearch.start") {
                return;
            }

            var results = Searcher.search(msgData.searchTerms);

            window.parent.postMessage({"results": results, "msgid": "docstrap.quicksearch.done"}, "*");
        });
    </script>
</body>
</html>
